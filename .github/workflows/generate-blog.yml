name: Generate Blog from WordPress

on:
  # DISABLED: Automatic generation every 6 hours
  # schedule:
  #   # Run every 6 hours to check for new posts
  #   - cron: '0 */6 * * *'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  generate-blog:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: Generate blog from WordPress
        env:
          WORDPRESS_URL: ${{ secrets.WORDPRESS_URL }}
        run: |
          echo "ðŸš€ Generating blog from WordPress..."
          python scripts/generate_blog.py
      
      - name: Check for changes
        id: changes
        run: |
          if [[ -n $(git status -s landing/blog/) ]]; then
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "ðŸ“ New blog posts detected!"
          else
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "âœ… No new posts"
          fi
      
      - name: Commit and push if changes
        if: steps.changes.outputs.changes == 'true'
        run: |
          git config --global user.name 'Blog Generator Bot'
          git config --global user.email 'bot@keywords.chat'
          git add landing/blog/
          git commit -m "ðŸ”„ Auto-update blog posts from WordPress"
          git push
          echo "âœ… Changes pushed - will trigger Cloud Run deploy via deploy-backend.yml"
      
      - name: No changes
        if: steps.changes.outputs.changes == 'false'
        run: echo "âœ… No new blog posts, nothing to commit"

