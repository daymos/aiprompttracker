version: '3'

vars:
  BACKEND_DIR: backend
  FRONTEND_DIR: frontend

tasks:
  dev:
    desc: Start everything (backend + frontend + database)
    cmds:
      - echo "ðŸš€ Starting KeywordsChat..."
      - task: db-start
      - echo "ðŸ”§ Starting backend on http://localhost:8000"
      - cd {{.BACKEND_DIR}} && uvicorn app.main:app --reload &
      - echo "ðŸŽ¨ Starting frontend on http://localhost:8080..."
      - cd {{.FRONTEND_DIR}} && flutter run -d chrome --web-port=8080

  setup:
    desc: First time setup - install dependencies and setup database
    cmds:
      - echo "ðŸ“¦ Installing dependencies..."
      - cd {{.BACKEND_DIR}} && pip install -r requirements.txt
      - cd {{.FRONTEND_DIR}} && flutter pub get
      - task: db-start
      - task: migrate

  db-start:
    desc: Start PostgreSQL database
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - docker-compose up -d db
      - sleep 3

  db-stop:
    desc: Stop PostgreSQL database
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - docker-compose stop db

  db-reset:
    desc: Reset database (WARNING - deletes all data)
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - docker-compose down -v
      - docker-compose up -d db
      - sleep 3
      - task: migrate

  migrate:
    desc: Run database migrations
    dir: "{{.BACKEND_DIR}}"
    cmds:
      - alembic upgrade head

  clean:
    desc: Clean up - stop all services and remove caches
    cmds:
      - docker-compose -f {{.BACKEND_DIR}}/docker-compose.yml down
      - rm -rf {{.BACKEND_DIR}}/__pycache__
      - rm -rf {{.FRONTEND_DIR}}/build
      - rm -rf {{.FRONTEND_DIR}}/.dart_tool
